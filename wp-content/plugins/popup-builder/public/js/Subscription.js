function SGPBSubscription(){this.expiryTime=365,this.submissionPopupId=0,this.newWindow=null,this.init()}SGPBSubscription.cookieName="SGPBSubscription",SGPBSubscription.prototype.init=function(){if("undefined"!=typeof SGPBFormBuilder)return!1;this.livePreview(),this.formSubmission()},SGPBSubscription.prototype.formSubmission=function(){var that=this;if("undefined"==typeof sgAddEvent)return!1;sgAddEvent(window,"sgpbDidOpen",function(e){var popupArgs=e.detail,popupId=popupArgs.popupId,popupOptions=SGPBPopup.getPopupOptionsById(popupId),additionalPopupParams={},subscriptionForm=jQuery("#sgpb-popup-dialog-main-div .sgpb-subs-form-"+popupId+" form"),submitButton=subscriptionForm.find(".js-subs-submit-btn"),sgpbSubsValidateObj={};try{sgpbSubsValidateObj=eval("sgpbSubsValidateObj"+popupId)}catch(e){}if("object"!=typeof sgpbSubsValidateObj)return!1;jQuery.validator.setDefaults({errorPlacement:function(e,s){var t=jQuery(s).attr("data-error-message-class");jQuery(".sgpb-subs-form-"+popupId+" ."+t).html(e)}}),sgpbSubsValidateObj.submitHandler=function(){var e=subscriptionForm.serialize(),s={action:"sgpb_subscription_submission",nonce:SGPB_JS_PARAMS.nonce,beforeSend:function(){submitButton.val(submitButton.attr("data-progress-title")),"redirectToURL"===popupOptions["sgpb-subs-success-behavior"]&&popupOptions["sgpb-subs-success-redirect-new-tab"]&&(that.newWindow=window.open(popupOptions["sgpb-subs-success-redirect-URL"]))},formData:e,popupPostId:popupId};jQuery.post(SGPB_JS_PARAMS.ajaxUrl,s,function(e){that.submissionPopupId=popupId,jQuery(".sgpb-subs-form-"+popupId+" .sgpb-alert").addClass("sg-hide-element"),submitButton.val(submitButton.attr("data-title")),additionalPopupParams.res=e,that.showMessages(additionalPopupParams),that.processAfterSuccessfulSubmission(s)})},subscriptionForm.validate(sgpbSubsValidateObj)}),jQuery(window).on("sgpbDidClose",function(e){var s=e.detail.popupId;jQuery(".sgpb-subs-form-"+s+" form label.error").hide()})},SGPBSubscription.prototype.processAfterSuccessfulSubmission=function(e){if(jQuery.isEmptyObject(e))return!1;e.action="sgpb_process_after_submission",jQuery.post(SGPB_JS_PARAMS.ajaxUrl,e,function(e){})},SGPBSubscription.prototype.showMessages=function(e){return 1==e.res?this.subscriptionSuccessBehavior():(null!==this.newWindow&&this.newWindow.close(),this.showErrorMessage()),window.dispatchEvent(new Event("resize")),!0},SGPBSubscription.prototype.showErrorMessage=function(){var e=parseInt(this.submissionPopupId);jQuery(".sgpb-subs-form-"+e+" .sgpb-alert-danger").removeClass("sg-hide-element")},SGPBSubscription.prototype.subscriptionSuccessBehavior=function(){var e={popupId:this.submissionPopupId,eventName:"sgpbSubscriptionSuccess"};jQuery(window).trigger("sgpbFormSuccess",e);var s=parseInt(this.submissionPopupId),t=SGPBPopup.getPopupOptionsById(s),i="showMessage";switch(jQuery(".sgpb-subs-form-"+s+" form").remove(),void 0!==t["sgpb-subs-hide-subs-users"]&&this.setSubscriptionCookie(s),void 0!==t["sgpb-subs-success-behavior"]&&(i=t["sgpb-subs-success-behavior"]),this.resetFieldsValues(),i){case"showMessage":jQuery(".sgpb-subs-form-"+s+" .sgpb-alert-success").removeClass("sg-hide-element");break;case"redirectToURL":this.redirectToURL(t);break;case"openPopup":this.openSuccessPopup(t);break;case"hidePopup":SGPBPopup.closePopupById(this.submissionPopupId)}},SGPBSubscription.prototype.openSuccessPopup=function(e){var s=this;setTimeout(function(){SGPBPopup.closePopupById(s.submissionPopupId)},0),void 0!==e["sgpb-subs-success-popup"]&&sgAddEvent(window,"sgpbDidClose",this.openPopup(e))},SGPBSubscription.prototype.openPopup=function(e){if(void 0===e["sgpb-subs-success-popup"])return!1;var s=parseInt(e["sgpb-subs-success-popup"]),t=SGPBPopup.getPopupOptionsById(s),i=new SGPBPopup;i.setPopupId(s),i.setPopupData(t),setTimeout(function(){i.prepareOpen()},500)},SGPBSubscription.prototype.setSubscriptionCookie=function(e){var s=window.location.href,t=SGPBSubscription.cookieName+e,i=this.expiryTime;if(""===SGPopup.getCookie(t)){var o=[s];SGPBPopup.setCookie(t,JSON.stringify(o),i)}},SGPBSubscription.prototype.redirectToURL=function(e){var s=e["sgpb-subs-success-redirect-URL"],t=e["sgpb-subs-success-redirect-new-tab"];if(SGPBPopup.closePopupById(this.submissionPopupId),t)return!0;window.location.href=s},SGPBSubscription.prototype.resetFieldsValues=function(){if(!jQuery(".js-subs-text-inputs").length)return!1;jQuery(".js-subs-text-inputs").each(function(){jQuery(this).val("")})},SGPBSubscription.prototype.livePreview=function(){this.binding(),this.changeLabels(),this.changeButtonTitle(),this.changeColor(),this.changeOpacity(),this.changePadding(),this.changeDimension(),this.preventDefaultSubmission(),"function"==typeof SGPBBackend&&SGPBBackend.makeContactAndSubscriptionFieldsRequired()},SGPBSubscription.prototype.preventDefaultSubmission=function(){var e=jQuery('.sgpb-subscription-admin-wrapper input[type="submit"]');if(!e.length)return!1;e.bind("click",function(e){e.preventDefault()})},SGPBSubscription.prototype.changeDimension=function(){var e=this;jQuery(".js-subs-dimension").change(function(){var s=jQuery(this),t=e.changeDimensionMode(s.val()),i=s.attr("data-style-type"),o=s.attr("data-field-type"),r=s.attr("data-subs-rel");"input"===o&&(jQuery(".sgpb-gdpr-label-wrapper").css("width",t),jQuery(".sgpb-gdpr-info").css("width",t));var p={};p[i]=t,jQuery("."+r).css(p)})},SGPBSubscription.prototype.changePadding=function(){jQuery(".js-sgpb-form-padding").on("change keydown keyup",function(){var e=jQuery(this).val();jQuery(".sgpb-subscription-admin-wrapper").css("padding",e+"px")})},SGPBSubscription.prototype.changeColor=function(){var e=this;if(void 0===jQuery.wp||"function"!=typeof jQuery.wp.wpColorPicker)return!1;jQuery(".js-subs-color-picker").each(function(){jQuery(this).wpColorPicker({change:function(){e.colorPickerChange(jQuery(this))}})}),jQuery(".wp-picker-holder").mouseover(function(){var s=jQuery(this).prev().find(".js-subs-color-picker");e.colorPickerChange(s)}),jQuery(".wp-picker-holder").bind("click",function(){var s=jQuery(this).prev().find(".js-subs-color-picker");e.colorPickerChange(s)})},SGPBSubscription.prototype.changeOpacity=function(){var e=this;jQuery(".js-subs-bg-opacity").next().find(".range-handle").on("change mousemove",function(){e.colorPickerChange(jQuery("input[name=sgpb-subs-form-bg-color]"))})},SGPBSubscription.prototype.setupPlaceholderColor=function(e,s){jQuery("."+e).each(function(){jQuery("#sgpb-placeholder-style").remove();var t="."+e+"::-webkit-input-placeholder {color: "+s+" !important;}";t+="."+e+"::-moz-placeholder {color: "+s+" !important;}";var i='<style id="sgpb-placeholder-style">'+(t+="."+e+"::-ms-placeholder {color: "+s+" !important;}")+"</style>";jQuery("head").append(i)})},SGPBSubscription.prototype.colorPickerChange=function(e){var s=jQuery("input[name=sgpb-subs-form-bg-opacity]").val(),t=e.val();if(void 0===t)return!1;t=SGPBBackend.hexToRgba(t,s);var i=e.attr("data-style-type"),o=e.attr("data-subs-rel");if("placeholder"===i)return this.setupPlaceholderColor(o,t),!1;var r={};r[i]=t,jQuery("."+o).each(function(){jQuery(this).css(r)})},SGPBSubscription.prototype.changeButtonTitle=function(){jQuery(".js-subs-btn-title").bind("input",function(){var e=jQuery(this).attr("data-subs-rel"),s=jQuery(this).val();jQuery("."+e).val(s)})},SGPBSubscription.prototype.changeLabels=function(){jQuery("#sgpb-subs-gdpr-text").on("change",function(){var e=jQuery(this).val();jQuery(this).text(""),jQuery(this).text(e),jQuery(".sgpb-gdpr-text-js").html(e)}),jQuery(".js-subs-field-placeholder").each(function(){jQuery(this).bind("input",function(){var e=jQuery(this).attr("data-subs-rel"),s=jQuery(this).val();"js-subs-gdpr-label"===e?jQuery("."+e).next().text(s):jQuery("."+e).attr("placeholder",s)})})},SGPBSubscription.prototype.binding=function(){var e=this;jQuery(".js-checkbox-field-status").bind("click",function(){var s=jQuery(this).is(":checked"),t=jQuery(this).attr("data-subs-field-wrapper"),i=jQuery("."+t);e.toggleVisible(i,s)}),jQuery(".js-checkbox-acordion").each(function(){var s=jQuery(this).is(":checked"),t=jQuery(this).attr("data-subs-rel"),i=jQuery("."+t);e.toggleVisible(i,s)})},SGPBSubscription.prototype.toggleVisible=function(e,s){s?e.css({display:"block"}):e.css({display:"none"})},SGPBSubscription.prototype.changeDimensionMode=function(e){var s;return s=parseInt(e)+"px",-1===e.indexOf("%")&&-1===e.indexOf("px")||(s=e),s},SGPBSubscription.prototype.allowToOpen=function(e){var s=!0,t=SGPBSubscription.cookieName+e;return""!=SGPopup.getCookie(t)&&(s=!1),s},jQuery(document).ready(function(){new SGPBSubscription});
